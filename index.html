<!DOCTYPE html>

<!--
  ~ Copyright (C) 2011 Benoit GUEROUT <bguerout at gmail dot com> and Yves AMSELLEM <amsellem dot yves at gmail dot com>
  ~
  ~ Licensed under the Apache License, Version 2.0 (the "License");
  ~ you may not use this file except in compliance with the License.
  ~ You may obtain a copy of the License at
  ~
  ~     http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~ Unless required by applicable law or agreed to in writing, software
  ~ distributed under the License is distributed on an "AS IS" BASIS,
  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~ See the License for the specific language governing permissions and
  ~ limitations under the License.
-->

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jongo {mongo-java-driver: 'with ease'}</title>

    <link href="assets/img/jongo_favicon.png" rel="shortcut icon" />

    <link href="assets/css/bootstrap.min.css" type="text/css" rel="stylesheet" />
    <link href="assets/css/bootstrap-responsive.min.css" type="text/css" rel="stylesheet" />
    <link href="assets/css/prettify.css" type="text/css" rel="stylesheet" />


    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->

    <script type="text/javascript" src="assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="assets/js/jquery.smoothanchors.min.js"></script>
    <script type="text/javascript" src="assets/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="assets/js/prettify.js"></script>
    <script type="text/javascript" src="assets/js/jongo.js"></script>

    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="pragma" content="no-cache" />
    <meta charset="utf-8" />
    <meta name="description" content="Query in Java as in Mongo shell (using strings), unmarshall results into Java objects (using Jackson)" />

    <link href="assets/css/jongo.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" id="ga-script">(function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

    ga('create', 'UA-30202616-1', 'auto');
    ga('send', 'pageview');</script>
</head>

<body data-spy="scroll" id="jongo">

    <div class="container">
        <section id="overview">
            <div class="intro">
                <div class="row">
                    <div class="span12">
                        <h1><img src="assets/img/jongo_big.png" alt="Jongo logo"/>Jongo</h1>
                    </div>
                </div>
                <div class="row">
                    <div class="span12 pitch">Query in <strong>Java</strong> as in <strong>Mongo</strong> shell</div>
                </div>
                <div class="row">
                    <div class="span9 offset2">
                        <span class="label shell">Shell</span>
                        <pre class="prettyprint samplecode">db.friends.find(<span class="query">{age: {$gt: 18}}</span>)</pre>

                        <span class="label driver">Java Driver</span>
                        <pre class="prettyprint samplecode">friends.find(new BasicDBObject("age",new BasicDBObject("$gt",18)))</pre>

                        <span class="label jongo">Jongo</span>
                        <pre class="prettyprint maincode">friends.find("{age: {$gt: 18}}").as(Friend.class)</pre>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <header class="nutshell">
        <div class="container">
            <div class="offset1">
                <div class="row">
                    <div class="span3">
                        <p class="lead">
                            <img src="assets/img/faithful.png" />
                            <strong>Faithful spirit</strong>Mongo query language isn't available in Java, Jongo fixes that.
                            Copy/paste your queries to string.
                        </p>
                    </div>
                    <div class="span3">
                        <p class="lead">
                            <img src="assets/img/objects.png" />
                            <strong>Object oriented</strong>Save &amp; find objects into &amp; from collections. Use embedded
                            Jackson marshalling or your own.
                        </p>
                    </div>
                    <div class="span3">
                        <p class="lead">
                            <img src="assets/img/wood.png" />
                            <strong>Wood solid</strong>As fast as Mongo Java driver. Open source, fully tested &amp; made of
                            rock solid librairies.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="navbar navbar-static-top">
        <div class="navbar-inner">
            <div class="container">
                <a class="brand" href="#jongo">Jongo</a>
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
                </a>

                <div class="nav-collapse collapse">
                    <ul class="nav">
                        <li><a href="#updating">Updating</a></li>
                        <li><a href="#mapping">Mapping</a></li>
                        <li><a href="#querying">Querying</a></li>
                        <li><a href="#advanced">Advanced</a></li>
                    </ul>
                    <ul class="nav pull-right">
                        <li><a href="https://groups.google.com/forum/?fromgroups#!forum/jongo-user" target="_blank"><i class="icon-envelope icon-white"></i>
                            Mailinglist</a></li>
                        <li><a href="https://github.com/bguerout/jongo" target="_blank"><i class="icon-github"></i>
                            GitHub</a></li>
                        <li><a href="#maven"><i class="icon-download-alt icon-white"></i> Download</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="container">

        <section id="maven" class="offset1">
            <div class="row">
                <div class="span9 header"><h1>Download</h1></div>
                <div class="span9">
                    <p>
                        Jongo relies upon
                        <a href="https://github.com/FasterXML/jackson-databind" target="_blank">Jackson</a>,
                        <a href="https://github.com/michel-kraemer/bson4jackson" target="_blank">Bson4Jackson</a> and
                        <a href="https://github.com/mongodb/mongo-java-driver" target="_blank">Mongo Java Driver</a>.
                        Its Maven dependency, an OSGI compliant jar, comes with the first two, you have to <a
                            href="http://mvnrepository.com/artifact/org.mongodb/mongo-java-driver" target="_blank">provide
                        a
                        dependency</a> to the driver.
                    </p>

                    <p>
                        Jongo is deployed into OSS Sonatype (<i>Maven repository hosting service for open source
                        projects</i>).<br/>Add the following dependency to your pom.xml
                    </p>

                    <pre class="prettyprint">
&lt;dependency&gt;
    &lt;groupId&gt;org.jongo&lt;/groupId&gt;
    &lt;artifactId&gt;jongo&lt;/artifactId&gt;
    &lt;version&gt;[1.5.0,)&lt;/version&gt;
&lt;/dependency&gt;
                    </pre>

                    <p>You can find the available versions at
                        <a target="_blank" href="https://mvnrepository.com/artifact/org.jongo/jongo">
                            mvnrepository</a></p>

                </div>
            </div>
        </section>

        <section id="usage" class="offset1">
            <div class="row">
                <div class="span9 header"><h1>Set up</h1></div>
                <div class="span9">
                    <p>
                        First <a href="http://www.mongodb.org/display/DOCS/Quickstart" target="_blank">install Mongo</a>,
                        then
                        choose a driver's version, finally <a href="#maven">download Jongo</a> and you're all set.
                    </p>
                    <pre class="prettyprint">
DB db = new MongoClient().getDB("dbname");

Jongo jongo = new Jongo(db);
MongoCollection friends = jongo.getCollection("friends");

MongoCursor&lt;Friend&gt; all = friends.find("{name: 'Joe'}").as(Friend.class);
Friend one = friends.findOne("{name: 'Joe'}").as(Friend.class);</pre>
                </div>
            </div>
        </section>

        <section id="updating" class="offset1">
            <div class="row">
                <div class="span9 header"><h1>Updating</h1></div>
                <div class="span9">
                    <h2 id="save">Save</h2>

                    <p>Passing an object to the <code>save(..)</code> method will do the job. See <a href="#mapping">mapping
                        section</a> for objects defintion.
                    </p>
                    <pre class="prettyprint">
Friend joe = new Friend("Joe", 27);

friends.save(joe);
joe.age = 28;
friends.save(joe);
</pre>

                    <h2 id="update">Update</h2>

                    <p>Update syntax is a bit different than in Mongo shell: <code>modifier</code> query has to be passed
                        using
                        <code>with(..)</code>. You can update with a <code>String</code> or with an object. You can also
                        parameterize queries with <code>#</code> (<i>using primitives or complex objects</i>), see <a href="#query-templating">query
                            templating</a> for more details.
                    </p>
                    <pre class="prettyprint">
friends.update("{name: 'Joe'}").with("{$inc: {age: 1}}");
friends.update("{name: 'Joe'}").upsert().multi().with("{$inc: {age: 1}}");

friends.update("{name: 'Joe'}").with(new Friend(..));
friends.update("{name: 'Joe'}").with("{$set: {address: #}}", new Address(..));
</pre>

                    <h2 id="insert">Insert</h2>

                    <p>Insert works as in Mongo shell.</p>
                    <pre class="prettyprint">
friends.insert("{name: 'Joe', age: 18}");

friends.insert(new Friend(..));
friends.insert(new Friend(..), new Friend(..));
</pre>

                    <h2 id="remove">Remove</h2>

                    <p>Remove works as in Mongo shell.</p>
                    <pre class="prettyprint">
friends.remove("{name: 'Joe'}");
friends.remove(new ObjectId("4c...e"));</pre>
                </div>
            </div>
        </section>

        <section id="mapping" class="offset1">
            <div class="row">
                <div class="span9 header"><h1>Object Mapping</h1></div>
                <div class="span9">
                    <p>
                        Query results are automatically mapped to objects. By default, this relies on Jackson; it respects
                        document structure, handles lists and ignores missing attributes. It just needs <strong>a no-arg
                        constructor, even private</strong> (<i>if the object has to be immutable, <code>@JsonCreator</code>
                        annotation can be used instead</i>).
                    </p>

                    <p>
                        <code>_id</code> is a unique identifier available on every Mongo document. <strong>If it isn't
                        setted,
                        it is generated</strong>. To handle it with Jongo, one attribute has to be named <code>_id</code> or
                        annotated with <code>@MongoId</code> (<i>alias for <code>@JsonProperty("_id")</code></i>). It can be
                        handled
                        with the dedicated <code>ObjectId</code> class or with a simple <code>String</code> — annotated
                        <code>@MongoObjectId</code>.
                    </p>

                    <p>
                        Careful, saving a document with a custom <code>_id</code> (<i>ie: any Java type, other than array,
                        so
                        long as it is unique</i>) always involves to set it manually before persisting.
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="span3">
                        <pre class="prettyprint">
public class Friend {
    // manual
    private long _id;

}</pre>
                </div>
                <div class="span3">
                      <pre class="prettyprint">
public class Friend {
    // manual
    @MongoId
    private long key;
}</pre>
                </div>
                <div class="span3">
                      <pre class="prettyprint">
public class Friend {
    // manual
    @MongoId
    private String key;
}</pre>
                </div>
            </div>
            <div class="row">
                <div class="span3">
                        <pre class="prettyprint">
public class Friend {
    // auto
    @MongoObjectId
    private String _id;
}</pre>
                </div>
                <div class="span3">
                      <pre class="prettyprint">
public class Friend {
    @MongoId // auto
    @MongoObjectId
    private String key;
}</pre>
                </div>
                <div class="span3">
                      <pre class="prettyprint">
public class Friend {
    // auto
    private ObjectId _id;

}</pre>
                </div>
            </div>

            <div class="row">
                <div class="span9">
                    <p>
                        <code>JSON</code> properties are automatically mapped to their equivalent object attributes (<i>and
                        complex ones mapped as sub-attributes</i>). <strong>No extra annotations needed</strong>. To ignore
                        a
                        pojo attribute, annotate it with <code>@JsonIgnore</code>.<br />For fine grained control over
                        (un)marshalling, configure <a href="#jongo-mapper">Jongo mapper</a> or <a href="#custom-mapper">create
                        your own</a>.
                    </p>

                    <h2 id="polymorphism">Handling polymorphism</h2>

                    <p>
                        To handle polymorphism of Java objects, a field containing the class name must be set into the Mongo
                        document. One can persist a <code>Fox</code> (<i>sub-class of <code>Friend</code></i>) and
                        manipulate it
                        as a <code>Friend</code>. This feature is provided out-of-the-box by Jackson. Using another
                        (un)marshaller implies extra work.
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="span5">
                      <pre class="prettyprint">
@JsonTypeInfo(use=Id.CLASS,property="_class")
public class Friend {
    int age;
}</pre>
                </div>
                <div class="span4">
                      <pre class="prettyprint">
public class Fox extends Friend {
    String name, color;
}</pre>
                </div>
            </div>
            <div class="row">
                <div class="span9">
                    <pre class="prettyprint">
friends.save(new Fox("fantastic", "red-haired"));
Friend friend = friends.findOne("{name:'fantastic'}").as(Friend.class);
Fox fantastic = (Fox)friend;</pre>

                    <p>
                        Using a singular <strong>reserved name</strong>, like <code>_class</code>, for this field is a good
                        idea.
                    </p>
                </div>
            </div>
        </section>

        <section id="querying" class="offset1">
            <div class="row">
                <div class="span9 header"><h1>Querying</h1></div>
                <div class="span9">

                    <h2 id="find">Find &amp; FindOne</h2>

                    <p>
                        Query syntax is <i>almost</i> the same as in Mongo shell: copy/paste, it just works.
                        <br />Strings have to be escaped with single quotes <code>"{name: 'Joe'}"</code>, numbers don't <code>"{age:
                        18}"</code>.
                    </p>

                    <pre class="prettyprint">
MongoCursor&lt;Friend&gt; all = friends.find("{name: 'Joe'}").as(Friend.class);

Friend joe = friends.findOne("{name: 'Joe'}").as(Friend.class);
Friend joe = friends.findOne(new ObjectId("4c...e")).as(Friend.class);</pre>

                    <p>
                        Field names need quotes when using dot notation <code>"{'address.city': 'London'}"</code>.
                    </p>

                    <h3>Projection or Field selection</h3>

                    <p>
                        Field selection aka. partial loading is not written as in Mongo shell:
                        Jongo exposes a <code>projection(..)</code> method. A json selector must be provided: <code>{field:
                        1}</code> to include it, <code>{field: 0}</code> to exclude it.
                    </p>
                    <pre class="prettyprint">friends.find().projection("{lastname: 1, address: 1}").as(Friend.class);</pre>

                    <h3 id="sorting">Sorting</h3>

                    <p>Documents can be sorted in ascending or descending order using a json selector: <code>{field:
                        1}</code>
                        for ascending, <code>{field: -1}</code> for descending.
                    </p>
                    <pre class="prettyprint">
friends.findOne().orderBy("{firstname: 1}").as(Friend.class);
friends.find().sort("{firstname: 1}").as(Friend.class);
friends.find().sort("{lasttname: -1}").as(Friend.class);</pre>

                    <h3 id="skip">Skip and Limit</h3>

                    <p>Behaviour similar to Java driver <a href="http://api.mongodb.org/java/current/com/mongodb/DBCursor.html" target="_blank">DBCursor</a>.
                    </p>
                    <pre class="prettyprint">
friends.find().skip(20).as(Friend.class);
friends.find().limit(10).as(Friend.class);</pre>

                    <h3 id="hint">Hint</h3>

                    <p>Behaviour similar to Java driver <a href="http://docs.mongodb.org/manual/reference/operator/hint/" target="_blank">Find.hint(..)</a>.</p>
                    <pre class="prettyprint">friends.find().hint("{age: 1}").as(Friend.class);</pre>

                    <h3 id="modifiers">Query modifiers</h3>

                    <p><a href="http://docs.mongodb.org/manual/reference/operator/query-modifier/" target="_blank">Query
                        modifiers</a> can be setted on <a href="http://api.mongodb.org/java/current/com/mongodb/DBCursor.html" target="_blank">DBCursor</a> by
                        implementing QueryModifier.</p>
                    <pre class="prettyprint">
friends.find().with(new QueryModifier() {
     public void modify(DBCursor cursor) {
         cursor.batchSize(10);
         cursor.addSpecial("$maxScan", 1);
     }
}).as(Friend.class);</pre>

                    <h3 id="closing">Closing cursor</h3>

                    <p>You can close cursor manually by calling <code>close()</code> method on MongoCursor</p>
                    <pre class="prettyprint">
MongoCursor&lt;Friend&gt; cursor = friends.find().as(Friend.class);
//iterate over it
cursor.close();</pre>

                    <h3 id="oid">Oid</h3>

                    <p>
                        As said in the <a href="#mapping">mapping section</a>, <code>_id</code> identifier can be
                        manipulated
                        with a <code>String</code> annotated with <code>@MongoObjectId</code>. If you want to completly
                        avoid using
                        driver's <code>ObjectId</code>, Jongo offers the <code>Oid</code> class.
                    </p>

                    <pre class="prettyprint">
import static org.jongo.Oid.withOid;

Friend joe = new Friend(); // @MongoObjectId String _id
friends.save(joe);
friends.find(withOid(joe.id)).as(Friend.class); // instead of new ObjectId(joe.id)</pre>

                    <h2 id="query-templating">Query templating</h2>

                    <p>
                        Almost all queries in Jongo can be templated: add anchors <code>#</code> as follow. Binded
                        parameters
                        can be <a href="http://stackoverflow.com/questions/3725386/java-types-in-org-bson-bsonobject">BSON
                        Primitives</a> or any complex type made of those.
                    </p>

                    <pre class="prettyprint">
friends.find("{name:#, age:#}", "Joe", 18); //→ will produce {name: 'Joe', age: 18}
friends.find("{address: #}", new Address(..)); //→ will marshall Address object</pre>
                    <pre class="prettyprint">
List&lt;String&gt; ages = Lists.newArrayList(22, 63);
friends.find("{age: {$in:#}}", ages); //→ will produce {age: {$in:[22,63]}}</pre>

                    <p>
                        Projections can also be templated
                    </p>
                    <pre class="prettyprint">
friends.find().projection("{name:#",1).as(Friend.class);
friends.find().projection("{family:{$elemMatch:{name:#}}}","Daddy").as(Friend.class);</pre>

                    <h2 id="regex">Regular expressions</h2>

                    <p>
                        Classic <code>$regex: 'jo.*'</code> operator works in Jongo. It worth mentioning that <code>Pattern.compile("jo.*")</code>
                        also does. Unluckily, JavaScript syntax <code>/jo*/g</code> is not available in Mongo Java Driver
                        and
                        Jongo cannot use it yet.
                    </p>

                    <pre class="prettyprint">
collection.findOne("{name: {$regex: #}}", "jo.*").as(Friend.class);
collection.findOne("{name:#}", Pattern.compile("jo.*")).as(Friend.class);</pre>

                    <h2 id="count">Count</h2>

                    <p>Behaviour similar to Java driver <a href="http://api.mongodb.org/java/current/com/mongodb/DBCollection.html#count()">DBCollection.count(..)</a>.
                    </p>
                    <pre class="prettyprint">friends.count("{name: 'Joe'}");</pre>

                    <p>Note that a <code>count()</code> method is also available on MongoCursor, behaviour similar to <a
                            href="http://api.mongodb.org/java/current/com/mongodb/DBCursor.html#count()" target="_blank">DBCursor.count()</a>
                    </p>

                    <pre class="prettyprint">
MongoCursor&lt;Friend&gt; cursor = friends.find().as(Friend.class);
int nbResults = cursor.count();</pre>

                    <h2 id="command">Command</h2>

                    <p>Behaviour pretty similar to Java driver <a href="http://docs.mongodb.org/manual/reference/method/db.runCommand">db.runCommand(..)</a>.
                    </p>
                    <pre class="prettyprint">jongo.runCommand("{geoNear: 'friends', near: [48,9]}").as(GeoNearResult.class);</pre>
                    <p>You can map command results to a single result field.</p>

                    <pre class="prettyprint">
jongo.runCommand("{geoNear: 'friends', near : [48.690,9.140]}")
          .throwOnError()
          .field("results")
          .as(GeoNearResult.class);</pre>

                    <h2 id="aggregation">Aggregation</h2>

                    <h3 id="distinct">Distinct</h3>

                    <p>Distinct syntax is almost the same as Find/FindOne operations. Optional query can be setted using
                        <code>query(..)</code>
                        method</p>
                    <pre class="prettyprint">List&lt;String&gt; names = friends.distinct("name").as(String.class);</pre>
                    <pre class="prettyprint">List&lt;Address&gt; addresses = friends.distinct("address").query("{name: 'Joe'}").as(Address.class);</pre>

                    <h3 id="aggregation-fwk">Aggregation Framework</h3>

                    <p>Careful, this feature is only available in the Mongo v2.2 release. All aggregation operators are
                        supported <code>$project, $match, $limit, $skip, $unwind, $group, $sort</code> and can be piped
                        using
                        <code>and(..)</code> method</p>
                    <pre class="prettyprint">
collection.aggregate("{$project:{sender:1}}")
          .and("{$match:{tags:'read'}}")
          .and("{$limit:10}")
          .as(Email.class);</pre>

                    <h2 id="advanced-query">Advanced query</h2>

                    <h3 id="geospacial">Geospacial indexing</h3>

                    <p>Using <a href="http://www.mongodb.org/display/DOCS/Geospatial+Indexing" target="_blank">Mongo
                        geospacial
                        capacities</a> requires an index and some BSON operators.</p>
                    <pre class="prettyprint">
friends.ensureIndex("{address: '2d'}");
friends.find("{address: {$near: [0, 0], $maxDistance: 5}}").as(Address.class);</pre>

                    <h3 id="readwrite">ReadPreference &amp; WriteConcern</h3>

                    <p><a href="http://docs.mongodb.org/manual/applications/replication/" target="_blank">Read and write
                        behaviors</a> can be configured on a query basis. <code>ReadPreference</code> defines how multiple
                        instances are readed, <code>WriteConcern</code> defines how writes are done.</p>
                    <pre class="prettyprint">friends.withWriteConcern(SAFE).withReadPreference(primaryPreferred()).find(..);</pre>

                    <h3 id="syntax">Complete query syntax</h3>

                    <p>Mongo uses a <a href="http://www.mongodb.org/display/DOCS/Mongo+Query+Language">behind the scenes
                        syntactic sugar</a> for methods like <code>sort(..)</code>, <code>limit(..)</code> and others. The
                        complete expression can also be used in Jongo.
                    </p>
                    <pre class="prettyprint">
friends.find("{$query: {}, $maxScan: 2}").as(Friend.class);
friends.find("{$query: {}, $orderby: {name: 1}}").as(Friend.class);</pre>
                </div>
            </div>
        </section>

        <section id="advanced" class="offset1">
            <div class="row">
                <div class="span9 header"><h1>Advanced</h1></div>
                <div class="span9">
                    <h2 id="performances">Performances</h2>

                    <p>
                        <strong>Jongo is lighting fast</strong>. Not because it is made of ancient wood and magic stones, it
                        just binds Jackson — the fastest Java json (un)marshalling library — to Mongo Java driver with the
                        slightest glue
                        code possible.
                    </p>

                    <p>
                        Since 0.3, Jongo uses Mongo Java driver at a deeper level to enhance performance. Instead of
                        converting
                        results into strings and unmarshalling strings into objects, it works at <code>byte[]</code> level (<i>query
                        marhalling works the same since 1.0</i>).
                    </p>

                    <p>
                        Several microbenchmarks (<i>using Caliper &amp; Yourkit</i>) highlight this release net improvements:
                        Jongo
                        0.3 is 6 times faster than Jongo 0.2, which make it <strong>as fast as the driver!</strong> Have a
                        look
                        at
                        <a href="http://microbenchmarks.appspot.com/run/bguerout@gmail.com/org.jongo.bench.FindBench2/2262004" target="_blank">find
                            microbenchmark</a> and <a href="http://microbenchmarks.appspot.com/run/bguerout@gmail.com/org.jongo.bench.SaveBench/2283001"
                                                      target="_blank">save microbenchmark</a>, and at their implementations (<a
                            href="https://github.com/bguerout/jongo/blob/master/src/test/java/org/jongo/bench/FindBench.java" target="_blank">find</a> &amp; <a
                            href="https://github.com/bguerout/jongo/blob/master/src/test/java/org/jongo/bench/SaveBench.java" target="_blank">save</a>).
                    </p>

                    <p>
                        <i class="icon-flag"></i> Not all benchmarks accurately reflect real world performance; <a
                            href="http://code.google.com/p/caliper/wiki/JavaMicrobenchmarks" target="_blank">more on
                        microbenchmarks</a>.
                    </p>

                    <h2 id="jongo-mapper">Configuring Jongo Mapper</h2>

                    <p>
                        Jongo comes with a custom Jackson configuration that can be extended.
                    </p>

                    <pre class="prettyprint">
DB db = new Mongo().getDB("dbname");

Jongo jongo = new Jongo(db,
  new JacksonMapper.Builder()
      .registerModule(new JodaModule())
      .enable(MapperFeature.AUTO_DETECT_GETTERS)
      .withView(Views.Public.class)
      .build()
);</pre>

                    <h3 id="mapper">Mapper interface</h3>

                    <p>
                        Jongo constructor comes with an optional parameter: <code>Mapper</code>. This interface has a
                        provided
                        <code>JacksonMapper</code> implementation which defines the defaut (un)marshalling behavior of
                        Jongo.
                        <code>JacksonMapper.Builder</code> allows to alter this configuration as you see fit.
                    </p>

                    <h3 id="features">Features on/off</h3>

                    <p>
                        Default <code>JacksonMapper.Builder()</code> comes with predefined features for the embedded Jackson
                        <code>ObjectMapper</code> (see <a
                            href="https://github.com/bguerout/jongo/blob/master/src/main/java/org/jongo/marshall/jackson/configuration/VisibilityModifier.java"
                            target="_blank">VisibilityModifier</a> and <a
                            href="https://github.com/bguerout/jongo/blob/master/src/main/java/org/jongo/marshall/jackson/configuration/PropertyModifier.java"
                            target="_blank">PropertyModifier</a>).
                        Those can be overridden and extended with <code>enable(..)</code> and <code>disable(..)</code>
                        methods.
                    </p>

                    <h3 id="modules">Modules</h3>

                    <p>
                        Jackson <code>Module</code> is a set of (un)marshalling configuration. Hanlding Joda dates, for
                        example,
                        can be done with this <a href="https://github.com/FasterXML/jackson-datatype-joda" target="_blank">Jackson
                        module</a> and the <code>registerModule(..)</code> method.
                    </p>

                    <h3 id="views">Json view</h3>

                    <p>
                        Jackson <code>@JsonView</code> allows to filter an object attributes on (un)marshalling. Once Jongo
                        is
                        configured to use the <code>Public</code> view (<i>as in the previous configuration</i>), the <code>gender</code>
                        attribute will be ignored even if it exists in Mongo.
                    </p>

                    <p>
                        Careful, when no view is defined, Jackson ignore annotations — which means every attribute is
                        visible.
                        Views can be used for marshalling-only or unmarshalling-only if needed.
                    </p>

                    <pre class="prettyprint">
public class Friend {
    private String _id;

    @JsonView(Views.Private.class)
    private String gender;
}

public class Views {
    public static class Public {}
    public static class Private extends Public {}
}</pre>

                    <h3 id="mappermodifier">MapperModifier</h3>

                    <p>
                        Jongo uses the <code>MapperModifier</code> interface to configure a <code>JacksonMapper</code>.
                        Looking
                        at <a
                            href="https://github.com/bguerout/jongo/blob/master/src/main/java/org/jongo/marshall/jackson/configuration/MapperFeatureModifier.java"
                            target="_blank">one implementation</a> give a good feeling of how it can be used to further
                        configure a <code>JacksonMapper</code>.
                    </p>

                    <h3 id="callbacks">Reader &amp; WriterCallback</h3>

                    <p>
                        In certain circumstances, modifying Jackson <code>ObjectReader</code> or <code>ObjectWriter</code>
                        will
                        be useful. <code>JacksonMapper</code> offers one default <code>ReaderCallback</code> and one <code>WriterCalback</code>
                        for that purpose, they can be replaced if needed.
                    </p>

                    <p>
                        <i class="icon-wrench"></i> For more options, refer to <a href="http://wiki.fasterxml.com/JacksonDocumentation" target="_blank">Jackson
                        documentation</a>.
                    </p>

                    <h2 id="custom-mapper">Using a custom Mapper</h2>

                    <p>
                        Instead of Jackson, one can provide his own implementation of <code>Mapper</code>.
                    </p>

                    <pre class="prettyprint">
public class GsonMapper extends Mapper {
    Marshaller getMarshaller() { ... }
    Unmarshaller getUnmarshaller() { ... }
    ObjectIdUpdater getObjectIdUpdater() { ... }
    QueryFactory getQueryFactory() { ... }
}

Jongo jongo = new Jongo(mongo.getDB("dbname"), new GsonMapper());</pre>

                    <h2 id="custom-result-handler">Using a custom ResultHandler</h2>

                    <p>
                        If one prefers to manually handle objects (<i>ie. without unmarshaller</i>), he can implements
                        <code>ResultHandler</code>. Each result entity will be passed to the inherited <code>handle(DBObject
                        result)</code> method.
                    </p>

                    <pre class="prettyprint">
MongoCursor&lt;Integer&gt; ages = friends.find("{name: 'Joe'}").map(
    new ResultHandler&lt;Integer&gt;() {
        @Override
        public Integer handle(DBObject result) {
            //do manual stuff here
            return result.get("age");
        }
    }
);</pre>

                    <h2 id="exposing-trough-jersey">Exposing objects through web services</h2>

                    <p>
                        Because Jongo uses custom Jackson annotations <code>@MongoId</code> and <code>@MongoObjectId</code>,
                        your pojos can be exposed through Jersey (<i>or Spring or any web services library</i>) without any
                        conflicts.
                    </p>
                </div>
            </div>
        </section>

    </div>

    <footer>
        <div class="container">
            <div class="offset1">
                <div class="row">
                    <div class="span9 creators">
                        Jongo is an open source Java library created by <a href="https://twitter.com/bguerout" target="_blank">Benoît Guérout</a> and <a
                            href="https://twitter.com/amsellemyves" target="_blank">Yves Amsellem</a>
                    </div>
                </div>
                <div class="row">
                    <div class="span7">
                        <p>
                            <a href="http://www.yourkit.com/" target="_blank"><img src="assets/img/yourkit-nb.png"
                                                                                   alt="yourkit logo"/></a>YourKit
                            is kindly supporting open source projects with its full-featured Java Profiler.
                            YourKit, LLC is the creator of innovative and intelligent tools for profiling
                            Java and .NET applications. Take a look at YourKit's leading software products:
                            <a href="http://www.yourkit.com/java/profiler/index.jsp" target="_blank">YourKit Java
                                Profiler</a> and
                            <a href="http://www.yourkit.com/.net/profiler/index.jsp" target="_blank">YourKit .NET
                                Profiler</a>.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

</body>
